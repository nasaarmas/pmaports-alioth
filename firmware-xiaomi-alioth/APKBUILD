# Maintainer: Nikroks <nikroks@mainlining.org>
pkgname=firmware-xiaomi-alioth
pkgver=1
pkgrel=0
pkgdesc="Firmware for alioth"
url="https://github.com/N1kroks/firmware-xiaomi-alioth"
arch="aarch64"
license="proprietary"
options="!strip !check !archcheck !tracedeps textrels pmb:cross-native"

_commit="95dfcdf6b154c00af3e093db82015cda90f4299a"

source="
	$pkgname.tar.gz::$url/archive/$_commit/$pkgname-$_commit.tar.gz
	30-initramfs-firmware.files
	firmware.files
	sensor.files
"

subpackages="$pkgname-sensors:firmware_sensors"

package() {
	while IFS="" read -r _i || [ -n "$_i" ]; do
		[ ! -d $(dirname $_i) ] && mkdir -p $(dirname $_i)
		install -Dm644 "$srcdir/$pkgname-$_commit/$_i" "$pkgdir/$_i"
	done < "$srcdir/firmware.files"

	install -Dm644 "$srcdir/30-initramfs-firmware.files" -t \
		"$pkgdir"/usr/share/mkinitfs/files
}

firmware_sensors() {
	pkgdesc="Files to be included to add sensor support"
	depends="$pkgname"
	install_if="$pkgname-nonfree-firmware"
	mkdir "$subpkgdir"

	while IFS="" read -r _i || [ -n "$_i" ]; do
		[ ! -d $(dirname $_i) ] && mkdir -p $(dirname $_i)
		install -Dm644 "$srcdir/$pkgname-$_commit/$_i" "$pkgdir/$_i"
	done < "$srcdir/sensor.files"
}

sha512sums="
2d110d8642dc2e7f83e4445f78b9019083d9c8712a1cb24742ce1ebfea10d540e1031daa124cb9917b4cf640d9ac53f7e3ab3ddbc7b624dcdcc81f85c0b2664b  firmware-xiaomi-alioth.tar.gz
d5def49ce5a4dbd5461e1ebcb3fbf4f66d71b9fa50d2ad44fa004e43d91db86766664f6d3f412cdcedf2bc0b04ad9a7a7b85fcff88b11409520ea49f68334412  30-initramfs-firmware.files
b932e91107f1104182f1ce74de102f8dc2bcbed75700111f1f3d8e8cee7c826855c6d58f4a3e246f8459c1828f617e9e07475ff7352f4171185bd1244b8d51b4  firmware.files
6d9412733f8d1764041360c009c6a6420398139d0d70016fef604c8f776531ce33b9f35d5bb7e7d8fc29941cda5034ae59978dce10fa3fa51d98ec60b7ba3aef  sensor.files
"
